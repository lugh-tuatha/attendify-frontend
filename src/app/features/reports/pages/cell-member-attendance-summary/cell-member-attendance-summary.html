<main class="main-container">
  <h1 class="font-bold text-2xl mt-4 print:-mx-4">
    LTHMI Recto Manila - 
    <span class="text-monochromatic-dark">Cell Member Attendance Summary</span>
  </h1>

  <div class="print:hidden mt-2 space-x-4">
    <mat-form-field appearance="outline" class="w-full md:w-72">
      <mat-label>MMMM DD, YYYY</mat-label>
      <input matInput [matDatepicker]="dp" [formControl]="date">
      <mat-datepicker-toggle matIconSuffix [for]="dp"></mat-datepicker-toggle>
      <mat-datepicker #dp></mat-datepicker>
    </mat-form-field>

    <mat-form-field appearance="outline" class="w-full md:w-88">
      <mat-label>Select Event</mat-label>
      <mat-select [(ngModel)]="selectedEvent" (selectionChange)="onSelectionChange($event)">
        @for (event of events; track $index) {
          <mat-option value="{{event.id}}">{{event.name}}</mat-option>
        }
      </mat-select>
    </mat-form-field>
  </div>

  <table class="w-full md:w-3/5 print:w-full print:-mx-4 border-2 border-monochromatic-base shadow-default border-collapse">
    <thead class="text-xl font-normal rounded-3xl">
      <tr>
        <th class="text-left px-4 py-3 font-bold">Member Status</th>
        <th class="text-right px-4 py-3 font-bold">Attendees</th> 
      </tr>
    </thead>

    <tbody>
      @if (isDisciplesDataLoading) {
        <app-report-skeleton></app-report-skeleton>
      }

      @if (!isDisciplesDataEmpty && !isDisciplesDataLoading) {
        <tr class="border">
          <th colspan="2" class="px-4 py-1 bg-monochromatic-dark font-bold text-left">
            Attendees
          </th>
        </tr>

        @for (category of summary?.attendees?.categories; track category.name) {
          <tr class="border">
            <td class="px-4 py-1">{{category.name}}</td>
            <td class="px-4 py-1 flex gap-2 justify-end items-center">
              <span>{{category.count || 0}}</span>
              <lucide-angular class="w-4 h-4" [img]="Users"></lucide-angular>
            </td>
          </tr>
        }
        <tr class="border">
          <td class="px-4 py-1 font-bold">TOTAL</td>
          <td class="px-4 py-1 font-bold flex gap-2 justify-end items-center">
            <span>{{summary?.attendees?.total || 0}}</span>
            <lucide-angular class="w-4 h-4" [img]="Users"></lucide-angular>
          </td>
        </tr>

        <tr class="border">
          <th colspan="2" class="px-4 py-1 bg-monochromatic-dark font-bold text-left">
            VIPs
          </th>
        </tr>
        @for (category of summary?.vips?.categories; track category.name) {
          <tr class="border">
            <td class="px-4 py-1">{{category.name}}</td>
            <td class="px-4 py-1 flex gap-2 justify-end items-center">
              <span>{{category.count || 0}}</span>
              <lucide-angular class="w-4 h-4" [img]="Users"></lucide-angular>
            </td>
          </tr>
        }
        <tr class="border">
          <td class="px-4 py-1 font-bold">TOTAL</td>
          <td class="px-4 py-1 font-bold flex gap-2 justify-end items-center">
            <span>{{summary?.vips?.total || 0}}</span>
            <lucide-angular class="w-4 h-4" [img]="Users"></lucide-angular>
          </td>
        </tr>
      }
    </tbody>
  </table>

  <div class="overflow-x-auto mt-4">
    <table class="w-full md:w-3/5 print:w-full print:-mx-4 border-2 border-monochromatic-base shadow-default border-collapse">
      <thead class="text-xl font-normal rounded-3xl">
        <tr>
          <th class="text-left px-4 py-3 font-bold">Name</th>
          <th class="text-left px-4 py-3 font-bold text-nowrap">Member Status</th>
          <th class="text-left px-4 py-3 font-bold">Process</th>
          <th class="text-right px-4 py-3 font-bold text-nowrap">Time Arrival</th> 
        </tr>
      </thead>
  
      <tbody>
        @if (!isDisciplesDataEmpty && !isDisciplesDataLoading) {
          <tr class="border">
            <th colspan="4" class="px-4 py-1 bg-monochromatic-dark font-bold text-left">
              {{ primaryLeaderFullName }}
            </th>
          </tr>
  
          @for (record of disciples; track $index) {
            <tr class="border">
              <td class="px-4 py-1 text-nowrap">
                {{record.firstName}} {{record.lastName}}
              </td>
              <td class="px-4 py-1">
                {{ record.memberStatus }}
              </td>
              <td class="px-4 py-1">
                {{ record.churchProcess }}
              </td>
              <td class="px-4 py-1 flex gap-2 justify-end items-center">
                <div class="flex items-center justify-end gap-4">
                  <span>
                    {{ record.attendance.length > 0
                      ? (record.attendance[0].timeIn | date: 'shortTime') 
                      : "-"
                    }}
                  </span>
                  <div 
                    class="w-2.5 h-2.5 rounded-full"
                    [ngClass]="{
                      'bg-danger-900': record.attendance.length > 0 && record.attendance[0].isLate,
                      'bg-success-900': record.attendance.length > 0 && !record.attendance[0].isLate,
                      'bg-gray-400': record.attendance.length === 0
                    }"
                  ></div>
                </div>
              </td>
            </tr>
          }
        }
      </tbody>
    </table>
  </div>

  @if (isDisciplesDataEmpty && !isDisciplesDataLoading) {
    <div class="w-3/5 mt-4">
      <app-error-card
        [statusCode]="204"
        title="Content Not Found"
        message="No attendance records found for this date."
        imageUrl="/assets/http.cat/204.jpeg"
      ></app-error-card>
    </div>
  }
</main>