<main class="main-container">
  <h1 class="font-bold text-2xl mt-4 print:-mx-4">
    LTHMI Recto Manila - 
    <span class="text-monochromatic-dark">Leaders Attendance Summary</span>
  </h1>

  <div class="print:hidden mt-2 space-x-4">
    <mat-form-field appearance="outline" class="w-full md:w-72">
      <mat-label>MMMM DD, YYYY</mat-label>
      <input matInput [matDatepicker]="dp" [formControl]="date">
      <mat-datepicker-toggle matIconSuffix [for]="dp"></mat-datepicker-toggle>
      <mat-datepicker #dp></mat-datepicker>
    </mat-form-field>

    <mat-form-field appearance="outline" class="w-full md:w-88">
      <mat-label>Select Event</mat-label>
      <mat-select [(ngModel)]="selectedEvent" (selectionChange)="onSelectionChange($event)">
        @for (event of events; track $index) {
          <mat-option value="{{event.id}}">{{event.name}}</mat-option>
        }
      </mat-select>
    </mat-form-field>
  </div>

  <h2 class="hidden print:block text-xl font-semibold text-text-300 mb-2 -mx-4">{{ date.value.toDate() | date: 'mediumDate' }} - {{selectedEvent}}</h2>

  <table class="w-full md:w-3/5 print:w-full print:-mx-4 border-2 border-monochromatic-base shadow-default border-collapse">
    <thead class="text-xl font-normal rounded-3xl">
      <tr>
        <th class="text-left px-4 py-3 font-bold">Name</th>
        <th class="text-right px-4 py-3 font-bold">Time Arrival</th> 
      </tr>
    </thead>

    <tbody>
      @if (leaderAttendanceList.isLoading) {
        <app-report-skeleton></app-report-skeleton>
      }

      @if (!leaderAttendanceList.isEmpty && !leaderAttendanceList.isLoading) {
        <tr class="border">
          <th colspan="2" class="px-4 py-1 bg-monochromatic-dark font-bold text-left">
            Primary Leader
          </th>
        </tr>

        @for (record of leaderAttendanceListData; track $index) {
          <tr class="border">
            <td 
              routerLink="/reports/attendance-summary/leaders/{{record.id}}"
              class="px-4 py-1 cursor-pointer hover:underline">
              {{record.firstName}} {{record.lastName}}
            </td>
            <td class="px-4 py-1 flex gap-2 justify-end items-center">
              <div class="flex items-center justify-end gap-4">
                <span>
                  {{ record.attendance.length > 0
                    ? (record.attendance[0].timeIn | date: 'shortTime') 
                    : "-"
                  }}
                </span>
                <div 
                  class="w-2.5 h-2.5 rounded-full"
                  [ngClass]="{
                    'bg-danger-900': record.attendance.length > 0 && record.attendance[0].isLate,
                    'bg-success-900': record.attendance.length > 0 && !record.attendance[0].isLate,
                    'bg-gray-400': record.attendance.length === 0
                  }"
                ></div>
              </div>
            </td>
          </tr>
        }
      }
    </tbody>
  </table>

  @if (leaderAttendanceList.isEmpty && !leaderAttendanceList.isLoading) {
    <div class="md:w-3/5 mt-4">
      <app-error-card
        [statusCode]="204"
        title="Content Not Found"
        message="We can't generate reports, no attendance records found for this date."
        imageUrl="/assets/http.cat/204.jpeg"
      ></app-error-card>
    </div>
  }
</main>